<div class="player-bar" *ngIf="playerState?.currentTrack">
    <div class="player-content">
        <!-- Informations de la piste en cours -->
        <div class="track-info">
            <div class="track-thumbnail">
                <img *ngIf="playerState?.currentTrack?.artistImage" [src]="playerState?.currentTrack?.artistImage"
                    [alt]="playerState?.currentTrack?.name" class="thumbnail-image" />

                <svg *ngIf="!playerState?.currentTrack?.artistImage" width="40" height="40" viewBox="0 0 40 40"
                    fill="none">
                    <rect width="40" height="40" rx="4" fill="url(#trackGradient)" />
                    <path d="M20 14L24 20H16L20 14Z M20 26L16 20H24L20 26Z" fill="white" opacity="0.8" />
                    <defs>
                        <linearGradient id="trackGradient" x1="0" y1="0" x2="40" y2="40">
                            <stop stop-color="#14B8A6" />
                            <stop offset="1" stop-color="#0891B2" />
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <div class="track-details">
                <div class="track-name">{{ playerState?.currentTrack?.name }}</div>
                <div class="track-artist">{{ playerState?.currentTrack?.artist }}</div>
            </div>
            <button class="icon-btn favorite-btn" aria-label="Ajouter aux favoris">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                    </path>
                </svg>
            </button>
        </div>

        <!-- Contrôles principaux -->
        <div class="player-controls">
            <div class="controls-buttons">
                <button class="icon-btn control-btn shuffle-btn" [class.active]="playerState?.shuffle"
                    (click)="toggleShuffle()" aria-label="Lecture aléatoire">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="16 3 21 3 21 8"></polyline>
                        <line x1="4" y1="20" x2="21" y2="3"></line>
                        <polyline points="21 16 21 21 16 21"></polyline>
                        <line x1="15" y1="15" x2="21" y2="21"></line>
                        <line x1="4" y1="4" x2="9" y2="9"></line>
                    </svg>
                </button>

                <button class="icon-btn control-btn" (click)="playPrevious()" aria-label="Piste précédente">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 6h2v12H6V6zm12 12V6l-8.5 6 8.5 6z" />
                    </svg>
                </button>

                <button class="play-pause-btn" (click)="togglePlayPause()" aria-label="Lecture/Pause">
                    <svg *ngIf="playerState?.status !== PlayerState.PLAYING" width="24" height="24" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path d="M8 5v14l11-7z" />
                    </svg>
                    <svg *ngIf="playerState?.status === PlayerState.PLAYING" width="24" height="24" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" />
                    </svg>
                </button>

                <button class="icon-btn control-btn" (click)="playNext()" aria-label="Piste suivante">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 18l8.5-6L6 6v12zM16 6h2v12h-2V6z" />
                    </svg>
                </button>

                <button class="icon-btn control-btn repeat-btn" [class.active]="playerState?.repeat"
                    (click)="toggleRepeat()" aria-label="Répéter">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="17 1 21 5 17 9"></polyline>
                        <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                        <polyline points="7 23 3 19 7 15"></polyline>
                        <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                    </svg>
                </button>
            </div>

            <!-- Barre de progression -->
            <div class="progress-section">
                <span class="time-label">{{ formatTime(playerState?.currentTime || 0) }}</span>
                <div class="progress-bar-container" (click)="onProgressBarClick($event)">
                    <div class="progress-bar">
                        <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
                        <div class="progress-handle" [style.left.%]="getProgressPercentage()"></div>
                    </div>
                </div>
                <span class="time-label">{{ formatTime(playerState?.duration || 0) }}</span>
            </div>
        </div>

        <!-- Contrôle du volume -->
        <div class="volume-control">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
            <input type="range" min="0" max="100" [value]="playerState?.volume || 70" (input)="onVolumeChange($event)"
                class="volume-slider" aria-label="Volume" />
            <span class="volume-label">{{ playerState?.volume || 70 }}%</span>
        </div>
    </div>
</div>

<!-- Message si aucune piste n'est chargée -->
<div class="player-bar player-bar-placeholder" *ngIf="!playerState?.currentTrack">
    <div class="placeholder-content">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18V5l12-2v13"></path>
            <circle cx="6" cy="18" r="3"></circle>
            <circle cx="18" cy="16" r="3"></circle>
        </svg>
        <span>Sélectionnez une piste pour commencer la lecture</span>
    </div>
</div>